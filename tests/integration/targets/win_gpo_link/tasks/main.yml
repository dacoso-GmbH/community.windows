---
  - name: Import GrouPolicy Module
    ansible.windows.win_shell: |
      Import-Module -Name GroupPolicy

  - name: Import activedirectory Module
    ansible.windows.win_shell: |
      Import-Module -Name activedirectory

  - name: Add GPO
    ansible.windows.win_shell: |
      New-GPO -Name {{ gpo_name }}

  - name: Run tests without check mode
    include_tasks: tests.yml

  - name: Remove GPO
    ansible.windows.win_shell: |
      Remove-GPO -Name {{ gpo_name }} -Force